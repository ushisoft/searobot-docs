# 通讯格式

协议版本：1.0

## 通讯参数
- 波特率：500K
- 帧类型：标准帧

## 上位机下发指令
当遥控器未开启时，可直接由CAN控制。在遥控器模式下需要将SWB开关拨到中间档位。

### 线速度、角速度设置指令
CAN_ID：0x01

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 线速度低八位 | int16 | 单位mm/s |
| Byte 1 | 线速度高八位 |  |  |
| Byte 2 | 角速度低八位 | int16 | 单位：0.001rad/s |
| Byte 3 | 角速度高八位 |  |  |
| Byte 4~7 | 保留 |  | 保留 |

**示例**：
- 线速度1000 mm/s 角速度0 rad/s：01 01 E8 03 00 00 00 00
- 线速度0 mm/s 角速度0.1rad/s：01 01 00 00 64 00 00 00
- 线速度100mm/s 角速度0.1rad/s：01 01 64 00 64 00 00 00
- 线速度-1000mm/s 角速度-0.1rad/s：01 01 18 FC 9C FF 00 00

### 左、右轮速设置指令
CAN_ID：0x01

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 0x01 | Unsigned int8 | 固定 |
| Byte 1 | 左轮速度低八位 | int16 | 单位mm/s |
| Byte 2 | 左轮速度高八位 |  |  |
| Byte 3 | 右轮速度低八位 | int16 | 单位mm/s |
| Byte 4 | 右轮速度高八位 |  |  |
| Byte 5~7 | 保留 |  | 保留 |

**示例**：
- 左轮度100mm/s 右轮速100mm/s：01 64 00 64 00 00 00
- 左轮度100mm/s 右轮速200mm/s：01 64 00 C8 00 00 00
- 左轮度-200mm/s 右轮速-200mm/s：01 38 FF 38 FF 00 00

### 启用/取消软件急停
CAN_ID：0x01

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 0x01 | Unsigned int8 | 固定 |
| Byte 1 | 0x0F | Unsigned int8 | 命令 |
| Byte 2 | 0x00/0x01 | Unsigned int8 | 0x00：取消急停<br>0x01：启用急停 |
| Byte 3~Byte 7 | 保留 |  | 保留 |

**示例**：
- 启用急停：01 0F 01 00 00 00 00 00
- 取消急停：01 0F 00 00 00 00 00 00

### 回充设置
CAN_ID：0x01

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 0x01 | Unsigned int8 | 固定 |
| Byte 1 | 0x10 | Unsigned int8 | 命令 |
| Byte 2 | 0x01 | Unsigned int8 | 0：关闭回充<br>1：开启红外回充<br>2：开启激光回充 |
| Byte 3~Byte 7 | 保留 |  | 保留 |

**示例**：
- 关闭回充：01 10 00 00 00 00 00 00
- 开启红外回充：01 10 01 00 00 00 00 00
- 开启激光回充：01 10 02 00 00 00 00 00

### 尝试清除错误状态
CAN_ID：0x01

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 0x01 | Unsigned int8 | 固定 |
| Byte 1 | 0x21 | Unsigned int8 | 命令 |
| Byte 2 | 0x01 | Unsigned int8 | 1：清除 |
| Byte 3~Byte 7 | 保留 |  | 保留 |

**示例**：
- 尝试清除错误状态：01 21 01 00 00 00 00 00

### 查询软件信息
CAN_ID：0x01

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 0x01 | Unsigned int8 | 固定 |
| Byte 1 | 0x31 | Unsigned int8 | 命令 |
| Byte 2~Byte 7 | 保留 |  | 保留 |

**示例**：
- 查询软件信息：01 31 00 00 00 00 00 00

## 底盘状态信息上传

### 线速度、角速度反馈
CAN_ID：0x10  
频率：50Hz

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 线速度低八位 | Int16 | 单位mm/s |
| Byte 1 | 线速度高八位 |  |  |
| Byte 2 | 角速度低八位 | Int16 | 单位：0.001rad/s |
| Byte 3 | 角速度高八位 |  |  |
| Byte 4~Byte 7 | 保留 |  | 保留 |

**示例**：
- 64 00 64 00 00 00 00 00：线速度: 100mm/s 角速度: 0.1rad/s。
- 38 FF 64 00 00 00 00 00：线速度：-200mm/s 角速度：0.1rad/s。

### 轮速反馈
CAN_ID：0x11  
频率：50Hz

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 左轮速度值低八位 | Int16 | 单位mm/s |
| Byte 1 | 左轮速度值高八位 |  |  |
| Byte 2 | 右轮速度值低八位 | Int16 | 单位mm/s |
| Byte 3 | 右轮速度值高八位 |  |  |
| Byte 4~Byte 7 | 保留 |  | 保留 |

**示例**：
- 64 00 96 00 00 00 00 00：左轮速度100mm/s，右轮速度150mm/s。
- 38 FF 9C FF 00 00 00 00：左轮速度-200mm/s，右轮速度-100mm/s。

### 电机电流反馈
CAN_ID：0x12
频率：100Hz

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 左电机电流低八位 | Int16 | 单位：0.1A |
| Byte 1 | 左电机电流高八位 |  |  |
| Byte 2 | 右电机电流低八位 | Int16 | 单位：0.1A |
| Byte 3 | 右电机电流高八位 |  |  |
| Byte 4~7 | 保留 |  | 保留 |

注：电流 = 数据值 * 0.1 A

**示例**：
- 32 00 46 00 00 00 00 00 ( 左电机电流：5A 右电机电流：7A )

### 遥控器数据上传
CAN_ID：0x13
频率：50Hz

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0-1 | 右摇杆左右 | Int16 | 左：-584、中：0、右：583 |
| Byte 2-3 | 右摇杆上下 | Int16 | 下：-584、中：0、上：583 |
| Byte 4-5 | 左摇杆上下 | Int16 | 下：-584、中：0、上：583 |
| Byte 6-7 | 左摇杆左右 | Int16 | 左：-584、中：0、右：583 |

CAN_ID：0x14
频率：50Hz

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----|
| Byte 0-1 | 左拨轮前后 | Int16 | VRA，后：-584、 中：0、 前：583 |
| Byte 2-3 | 右拨轮前后 | Int16 | VRB，后：-584、 中：0、 前：583 |
| Byte 4 | 拨杆 | Unsigned int8 | 占位，Bit 0-1：SWA、Bit 2-3：SWB、Bit 4-5：SWC、Bit 6-7：SWD <br> 取值，0：下、1：中、2：上、3：保留 |
| Byte 5 | 遥控状态 | Unsigned int8 | Bit 0：是否离线，Bit 1-7：保留 <br>取值，0：否、1：是 |
| Byte 6-7 | 保留 |  | 保留 |

**示例**：
```
ID：0x13: 00 00 47 02 B8 FD 47 02
```
- 右摇杆-左右：0
- 右摇杆-上下：583
- 左摇杆-上下：-584
- 左摇杆-左右：583

```
ID：0x14: 47 02 64 00 98 00 00 00
```
- 左拨轮-前后：583
- 右拨轮-前后：100
- 拨杆：SWA-上(2)，SWB-中(1)，SWC-上(2)，SWD-下(0)
- 遥控状态：在线

### 系统信息
CAN_ID：0x20
频率：100Hz

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----|
| Byte 0 | 控制输入模式 | Unsigned int8 |  <br> 0x00：空闲状态 <br> 0x01：遥控器模式 <br> 0x02：上位机模式 <br> 0x03：自动回充模式 |
| Byte 1 | 电池电量百分比 | Unsigned int8 | 根据电压换算，范围0%~100% |
| Byte 2-3 | 电池电压 | Unsigned int16 | 单位：0.1V |
| Byte 4-5 | 底盘状态 | Unsigned int16 | Bit0：硬件急停 <br> Bit1：遥控急停 <br> Bit2：软件急停 <br> Bit3：遥控离线 <br> Bit4：前防撞杆 <br> Bit5：后防撞杆 <br> Bit6~Bit15：保留 <br> 1：急停/触发/离线，0：正常/无急停/无触发/保留 |
| Byte 6-7 | 底盘错误 | Unsigned int16 | Bit0：驱动器掉线 <br> Bit1：驱动器错误 <br> Bit2~Bit15：保留 <br> 1：掉线/错误，0：在线/正常 <br> 注：驱动器错误包括掉线 |

**示例**：
```
02 39 FE 01 00 00 00 00
```
控制输入模式：上位机模式
电池电量：57%
电池电压：51V
底盘状态：无急停，无掉线，无触发防撞杠
底盘错误：无错误

### 自动回充
CAN_ID：0x21
频率：100Hz

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----|
| Byte 0 | 回充模块掉线 | Unsigned int8 | 0x00：在线 <br> 0x01：掉线 |
| Byte 1 | 当前回充工作模式 | Unsigned int8 | 0x00：空闲 <br> 0x01：红外模式 <br> 0x02：激光模式 |
| Byte 2 | 回充模组状态 | Unsigned int8 | Bit0：回充桩行程开关状态 <br> Bit1：回充头电压检测状态 <br> 0：弹起/未检测到电压 <br> 1：按下/检测到电压 |
| Byte 3 | 红外回充模式状态 | Unsigned int8 | 0x00：寻找中心 <br> 0x01：已找到中心 <br> 0x02：信号丢失 <br> 0x03：铜片接触成功 <br> 0x04：对接成功 <br> 0x05：对接错误 <br> 0x07：退出充电状态 <br> 0x08：回充任务结束/回充任务关闭 |
| Byte 4~7 | 保留 |  | 保留 |

**示例**：
```
00 01 00 01 00 00 00 00
```
- 回充模块：在线
- 当前回充工作模式：红外模式
- 回充模组状态：行程开关弹起，未检测到电压
- 红外回充模式状态：已找到中心

### 驱动器、电机故障
CAN_ID：0x30
频率：100Hz

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----|
| Byte 0-1 | 左电机故障 | Unsigned int16 | 0：正常 <br> 1：故障 <br> Bit0：电池欠压 <br> Bit1：位置异常 <br> Bit2：霍尔错误 <br> Bit3：过流 <br> Bit4：超载 <br> Bit5：EEPROM故障 <br> Bit6：IGBT故障 <br> Bit7：驱动器过热 <br> Bit8：电机缺相 <br> Bit9：电流超差 <br> Bit10：速度超差 <br> Bit11：电机过热 <br> Bit12：电源过压 <br> Bit13：飞车故障 <br> Bit14：驱动器过热 <br> Bit15：保留 |
| Byte 2-3 | 右电机故障 | Unsigned int16 | 
| Byte 4~7 | 保留 |  | 保留 |

**示例**：
```
08 00 04 00 00 00 00 00
```
- 左电机故障：过流
- 右电机故障：霍尔错误

### 软件信息
CAN_ID：0x41
查询式

| 字节 | 说明 | 数据类型 | 备注 |
|:----:|:----:|:--------:|:----:|
| Byte 0 | 程序版本号 | Unsigned int8 | 主版本号 |
| Byte 1 | 程序版本号 | Unsigned int8 | 次版本号 |
| Byte 2 | 程序版本号 | Unsigned int8 | 修订版本号 |
| Byte 3 | 保留 | Unsigned int8 | 保留 |
| Byte 4 | 日期版本号 | Unsigned int8 | 年份:年份后两位数 |
| Byte 5 | 日期版本号 | Unsigned int8 | 月份；范围1-12 |
| Byte 6 | 日期版本号 | Unsigned int8 | 日期：范围1-31 |
| Byte 7 | 保留 | Unsigned int8 | 保留 |

**示例**：
```
02 00 00 00 18 09 01 00
```
- 软件版本：v2.0.0
- 日期：24年9月1日 
